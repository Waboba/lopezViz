<!DOCTYPE html>
<html lang="es">
<head>
  <title>D3.js - Componentes de un Gráfico</title>
  <meta charset="utf-8"/>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.24.0/d3-legend.js"></script>

  <style>
    .texto {
      font-size: 40px;
      font-family: "Montserrat", sans-serif;
      font-weight: 400;
    }

    .h1_texto {
      font-size: 40px;
      font-family: "calibri", sans-serif;
      font-weight: 400;
    }

    .titulo {
      font-size: 70px;
      font-family: "Montserrat", sans-serif;
      font-weight: 400;
    }
  </style>

</head>
<body>
<div id="bote">
  <svg id="botesito" width="1000" height="1000" style="overflow: visible; margin: 5px;">
    <defs>
      <!-- Adjusted pattern definition -->
      <pattern id="patron" patternUnits="userSpaceOnUse" width="200" height="56"></pattern>
    </defs>
    <path id="pathBote" d="m 50 50 l 25 0 l 5 -10 l -10 0 l 0 -3 l -4 0 l 0 -4 l -4 0 l 0 4 l -4 0 l 0 -4 l -4 0 l 0 4 l -4 0 l 0 -4 l -4 0 l 0 4 l -4 0 l 0 -4 l -4 0 l 0 4 l -4 0 l 0 3 l -10 0 l 5 10 l 22 0"
          fill="url(#patron)" stroke="#000" stroke-width="1" />
  </svg>
</div>

<div id="viz">
  <svg width="1000" height="1000"></svg>
</div>

<script type="text/javascript">
  d3.csv("train.csv").then(function(data){
    let class1 = 0;
    let class2 = 0;
    let class3 = 0;
    data.forEach(function(dato) {
      if (dato.Pclass == 1) { class1++ }
      if (dato.Pclass == 2) { class2++ }
      if (dato.Pclass == 3) { class3++ }
    });

    let total = class1 + class2 + class3;
    let proporcion1 = class1 / total;
    let proporcion2 = class2 / total;
    let proporcion3 = class3 / total;

    let height = 21; // total pattern height
    let altura1 = height * proporcion1;
    let altura2 = height * proporcion2;
    let altura3 = height * proporcion3;

    let pattern = d3.select('#patron')
            .attr('x', 0)
            .attr('y', -8.5)
            .attr('height', height)
            .attr('width', 200);

    let rect1=pattern.append('rect')
            .attr('x', 0)
            .attr('y', 0)
            .attr('height', altura1)
            .attr('width', 200)
            .attr('fill', '#E9EFC0')
            .attr('opacity', 1);

    let rect2 = pattern.append('rect')
            .attr('x', 0)
            .attr('y', altura1)
            .attr('height', altura2)
            .attr('width', 200)
            .attr('fill', '#B4E197')
            .attr('opacity', 1);

    let rect3 =pattern.append('rect')
            .attr('x', 0)
            .attr('y', altura1 + altura2)
            .attr('height', altura3)
            .attr('width', 200)
            .attr('fill', '#83BD75')
            .attr('opacity', 1);

    d3.select('#pathBote')
            .attr('transform', `translate(450,-500) scale(25)`)
            .attr('fill', 'url(#patron)');

    const texto1 = d3.select("svg")
            .selectAll("text .label")
            .data(data)
            .enter()
            .append("text")
            .attr("class", "texto")
            .style("font-size",`${Math.min(40,200*proporcion )}`+'px')
            .text(percent+"%")
            .attr("fill", "black")
            .attr("text-anchor", "end")
            .attr("y", function (d, i) {
              return 1170;
            })
            .attr("x", xrect*15+1350-7);
    const texto2= d3.select("svg")
            .selectAll("text .label")
            .data(data)
            .enter()
            .append("text")

            .attr("class", "texto")
            .text(100-percent+"%")
            .style("font-size",`${Math.min(40,100*(1-proporcion))}`+'px')
            .attr("fill", "white")
            .attr("text-anchor", "start")
            .attr("y", function (d, i) {
              return 1170;
            })
            .attr("x", xrect*15+1350+25);
    const texto3=d3.select("svg")
            .selectAll("text .label")
            .data(data)
            .enter()
            .append("text")
            .attr("class", "titulo")
            .text("El Titanic")
            .attr("fill", "black")
            .attr("text-anchor", "middle")
            .attr("y", function (d, i) {
              return 100;
            })
            .attr("x", 1000);
    d3.select("svg").append('rect')
            .attr('x', 2700)
            .attr('y', 1000)
            .attr('width', 50)
            .attr('height', 50)
            .attr('fill', ' #8cbed6');
    d3.select("svg").append('rect')
            .attr('x', 2700)
            .attr('y', 1100)
            .attr('width', 50)
            .attr('height', 50)
            .attr('fill', 'pink');
    d3.select("svg").append('text')


            .attr("class", "texto")
            .text("Hombres")
            .style("font-size",`${Math.min(40,100*(1-proporcion))}`+'px')
            .attr("fill", "black")
            .attr("text-anchor", "start")
            .attr("y", function (d, i) {
              return 1040;
            })
            .attr("x", 2760);
    d3.select("svg").append('text')


            .attr("class", "texto")
            .text("Mujeres")
            .style("font-size",`${Math.min(40,100*(1-proporcion))}`+'px')
            .attr("fill", "black")
            .attr("text-anchor", "start")
            .attr("y", function (d, i) {
              return 1140;
            })
            .attr("x", 2760);

    function flipFigure() {
      const group = d3.select('#pathBote');


      group.transition()
              .duration(1000)
              .attr('transform', 'translate(1000,250) scale(15) rotate(45, 10, 0)') // Rotate around the center
              .on('end', function() {

                const newProporcion = Math.round(mujeresSurv/(mujeresSurv+hombresSurv) * 100) / 100; // New percentage after flip (e.g., 35%)
                const newPercent = newProporcion * 100;


                let newFirstColorWidth = ancho * newProporcion;



                d3.select('#patron rect:nth-child(1)')
                        .transition()
                        .duration(1000)
                        .attr('width', newFirstColorWidth);

                d3.select('#patron rect:nth-child(2)')
                        .transition()
                        .duration(1000)
                        .attr('x', newFirstColorWidth);


                texto1.transition()
                        .duration(1000)
                        .style("fill", "black")
                        .style("font-size", `${Math.min(40, 100 * newProporcion)}` + 'px')
                        .text(newPercent + "%")
                        .attr("x", newFirstColorWidth * 15 + 750 - 65)
                        .attr("y",1220);

                texto2.transition()
                        .duration(1000)
                        .style("font-size", `${Math.min(40, 100 * (1 - newProporcion))}` + 'px')
                        .text(100 - newPercent + "%")
                        .attr("x", newFirstColorWidth * 15 + 750 - 25)
                        .attr("y",1355);
                texto3.transition()
                        .duration(1000)
                        .style("fill", "black")
                        .text("Distribución de supervivientes por sexo en el Titanic")

              });


      texto1.transition()
              .duration(1000)
              .style("fill", "white");
      texto3.transition()
              .duration(1000)
              .style("fill", "white");
    }

    d3.select('#botesito').on('click', flipFigure);
  })


</script>
</html>